<!DOCTYPE HTML>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title>MHacks Game</title>
    <script type = "text/javascript"
            src = "simpleGame.js"></script>
    <script type = "text/javascript">
        var game;
        var background;
        var character;
        var missiles;
        var num_missiles = 999;
        var currentMissile = 0;
        var delay = .5;
        var timer;
        var elapsedTime;

        function Character(){
            tCharacter = new Sprite(game, "rpg_sprite_walk.png", 192, 128);
            tCharacter.loadAnimation(192, 128, 24, 32);
            tCharacter.generateAnimationCycles();
            tCharacter.renameCycles(new Array("down", "up", "left", "right"));
            tCharacter.setAnimationSpeed(500);

            tCharacter.setSpeed(0);
            tCharacter.setPosition(50, 150);
            tCharacter.direction = 180;
            tCharacter.pauseAnimation();
            tCharacter.setCurrentCycle("down");

            tCharacter.checkKeys = function(){
                elapsedTime = timer.getElapsedTime();
                if (keysDown[K_A]){
                    this.changeXby(-2);
                    this.direction = 270;
                    this.setMoveAngle(270);
                    this.setCurrentCycle("left");
                }
                if (keysDown[K_D]){
                    this.changeXby(2);
                    this.direction = 90;
                    this.setMoveAngle(90);
                    this.setCurrentCycle("right");
                }                
                if (keysDown[K_W]){
                    this.changeYby(-2);
                    this.direction = 0;
                    this.setMoveAngle(0);
                    this.setCurrentCycle("up");
                }                
                if (keysDown[K_S]){
                    this.changeYby(2);
                    this.direction = 180;
                    this.setMoveAngle(180);
                    this.setCurrentCycle("down");
                }                
                
                if (keysDown[K_SPACE]){ /* Talk to people, attack stuff, inspect stuff */
                    this.setSpeed(0);
                    this.pauseAnimation();
                    if (elapsedTime > delay){
                        currentMissile++;
                        if (currentMissile > num_missiles){
                            currentMissile = 0;
                        }
                        missiles[currentMissile].fire();
                        timer.reset();
                    }
                }
            }

            tCharacter.checkBounds = function(){
                if (this.x < 12){
                    this.setPosition(12, this.y);
                    this.setSpeed(0);
                }
                if (this.x > 788){
                    this.setPosition(788, this.y);
                    this.setSpeed(0);
                }
                if (this.y < 12){
                    this.setPosition(this.x, 12);
                    this.setSpeed(0);
                }
                if (this.y > 588){
                    this.setPosition(this.x, 588);
                    this.setSpeed(0);
                }
            }

            return tCharacter;
        }

        function Enemy () {
            tEnemy= new Sprite(game,"enemy.jpeg",27,56);
            tEnemy.setPosition(700,450);
            tEnemy.horVert = Math.random();
            console.log(tEnemy.horVert);
            if (tEnemy.horVert < 0.5){
                tEnemy.setDX(-5);
                tEnemy.setDY(0);
                tEnemy.direction = 270;
            }
            else{
                tEnemy.setDX(0);
                tEnemy.setDY(5);
                tEnemy.direction = 180;
            }

            tEnemy.checkBounds = function(){
                if (this.x < 12){
                    this.setPosition(12, this.y);
                    this.dx = -1 * this.dx;
                }
                if (this.x > 788){
                    this.setPosition(788, this.y);
                    this.dx = -1 * this.dx;
                }
                if (this.y < 12){
                    this.setPosition(this.x, 12);
                    this.dy = -1 * this.dy;
                }
                if (this.y > 588){
                    this.setPosition(this.x, 588);
                    this.dy = -1 * this.dy;
                }
            }
            return tEnemy;
        }

        function Missile(){
            tMissile = new Sprite(game, "missile.png", 30, 20);
            tMissile.hide();
            
            tMissile.fire = function(){
                this.show();
                this.setSpeed(15);
                this.setBoundAction(DIE);
                this.setPosition(character.x, character.y);
                this.setAngle(character.direction);
                this.setSpeed(15);
            } // end fire
            
            return tMissile;
        } // end missile def
        
        function makeMissiles(){
            missiles = new Array(num_missiles);
            for (i = 0; i < num_missiles; i++){
                missiles[i] = new Missile();
            }
        }

        function updateMissiles(){
            for (i = 0; i < num_missiles; i++){
                missiles[i].update();
            }
        }
        
        function init(){
            game = new Scene();
            timer = new Timer();
            character = new Character();
            enemy = new Enemy();
            background = new Sprite(game, "background2.jpg", 800, 600);
            background.setSpeed(0,0);
            background.setPosition(400, 300);
            makeMissiles();
            
            game.start();
        } // end init
        
        function update(){
            game.clear();
            background.update();
            character.checkKeys();
            character.checkBounds();
            character.update();
            enemy.checkBounds();
            enemy.update();
            updateMissiles();
        } // end update

        

    </script>
</head>
<body onload = "init()">
</body>
</html>
